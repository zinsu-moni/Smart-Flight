<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Flight Agent UI</title>
  <style>body{font-family:Arial,Helvetica,sans-serif;margin:20px}label{display:block;margin-top:8px}</style>
</head>
<body>
  <h1>Flight Agent (scaffold)</h1>
  <form id="form">
    <label>Origin:
      <input name="origin" list="airports" placeholder="ICN or 'Seoul'" value="ICN" required>
    </label>

    <label>Destination:
      <input name="destination" list="airports" placeholder="LAX or 'Los Angeles'" value="LAX" required>
    </label>

    <datalist id="airports">
      <!-- a short list of common IATA codes; users can also type any value -->
      <option value="ICN">Incheon (ICN)</option>
      <option value="GMP">Gimpo (GMP)</option>
      <option value="LAX">Los Angeles (LAX)</option>
      <option value="SFO">San Francisco (SFO)</option>
      <option value="JFK">New York JFK (JFK)</option>
      <option value="NRT">Tokyo Narita (NRT)</option>
      <option value="HND">Tokyo Haneda (HND)</option>
      <option value="LHR">London Heathrow (LHR)</option>
      <option value="CDG">Paris Charles de Gaulle (CDG)</option>
    </datalist>

    <div style="margin:6px 0">
      <button type="button" id="swap">Swap Origin/Destination</button>
    </div>

    <label>Date: <input name="date" type="date" value="2025-12-01" required></label>
    <label>Adults: <input name="adults" type="number" value="1" min="1" required></label>

    <label style="display:block;margin-top:10px">Natural language (optional):
      <input name="nl" placeholder="e.g. 'Cheapest ICN to LAX on 2025-12-01 for 2 adults'" style="width:100%">
    </label>

    <div style="margin-top:8px"><button type="submit">Find cheapest</button></div>
  </form>

  <pre id="out" style="background:#f7f7f8;padding:12px;border:1px solid #ddd;margin-top:12px;white-space:pre-wrap"></pre>

  <script>
    // Simple client-side natural language parsing (very light):
    // looks for three-letter IATA codes, a yyyy-mm-dd date, and a number of adults.
    function parseNaturalText(text) {
      if (!text) return null;
      const iata = text.toUpperCase().match(/\b([A-Z]{3})\b/g);
      const date = text.match(/(20\d{2}-\d{2}-\d{2})/);
      const adultsMatch = text.match(/(\d+)\s+adults?/i) || text.match(/for\s+(\d+)/i);
      const result = {};
      if (iata && iata.length >= 2) {
        result.from = iata[0];
        result.to = iata[1];
      }
      if (date) result.date = date[1];
      if (adultsMatch) result.adults = Number(adultsMatch[1]);
      return result;
    }

    const form = document.getElementById('form');
    const out = document.getElementById('out');
    const swapBtn = document.getElementById('swap');
    swapBtn.addEventListener('click', () => {
      const o = form.elements['origin'];
      const d = form.elements['destination'];
      const tmp = o.value; o.value = d.value; d.value = tmp;
    });

    form.addEventListener('submit', async (ev) => {
      ev.preventDefault();
      const f = new FormData(form);
      const nl = (f.get('nl') || '').trim();

      let query = {
        from: f.get('origin'),
        to: f.get('destination'),
        date: f.get('date'),
        adults: Number(f.get('adults') || 1)
      };

      if (nl) {
        const parsed = parseNaturalText(nl);
        if (parsed) {
          // Only override fields that were parsed
          if (parsed.from) query.from = parsed.from;
          if (parsed.to) query.to = parsed.to;
          if (parsed.date) query.date = parsed.date;
          if (parsed.adults) query.adults = parsed.adults;
        } else {
          out.textContent = 'Could not parse natural language input. Using form values.';
        }
      }

      const payload = { query };
      out.textContent = 'Request: ' + JSON.stringify(payload, null, 2) + '\n\n';

      try {
        const resp = await fetch('/a2a/flight', { method: 'POST', headers: { 'content-type': 'application/json' }, body: JSON.stringify(payload) });
        const text = await resp.text();
        out.textContent += 'Status: ' + resp.status + '\n\n' + text;
      } catch (e) {
        out.textContent += 'Fetch error: ' + e;
      }
    });
  </script>
</body>
</html>
